jobs:
  include:
    - stage: Tests
      name: "Kourou Lint"
      language: node_js
      node_js: 12
      cache:
        directories:
          - ~/.npm
          - ~/.cache
          - node_modules # NPM packages

      install:
        - npm install --silent --unsafe-perm
        - npm install --silent --unsafe-perm --only=dev

      script:
        - npm run test:lint

    - stage: Tests
      name: "Kourou Functional Tests"
      language: node_js
      node_js: 12
      cache:
        directories:
          - ~/.npm
          - ~/.cache
          - node_modules # NPM packages

      install:
        - npm install --silent --unsafe-perm
        - npm install --silent --unsafe-perm --only=dev

      script:
        - bash features/run-kuzzle-stack.sh
        - npm run test:functional

    # - stage: Deploy
    #   name: Deploy Kourou on NPM
    #   if: type = push AND branch = master
    #   sudo: false
    #   language: node_js
    #   node_js: 12
    #   install:
    #     - npm install
    #   script:
    #     - npm run build
    #   deploy:
    #     provider: npm
    #     skip_cleanup: true
    #     email: support@kuzzle.io
    #     api_key:
    #       secure: "oZG8eiOGQxH5sEvTI6sNcSL8+RnE/qOs1TMOn1eB0GvRB/pQ9Oylzunjntp7WzHpEm23+3Cfj898sgQ6uNBeKm/bEYOxN+kYbzpY0kSiwaW+dDneFzVIa+r1dF8+/oCvH720VIu+92KYK/8+A6jJGlevMezL+w5ggD6I2j0i+QBPyplvh5qjyd7OayGPCPUq22Om9U9QPux4FFYmpX6TDn/l0iVYat0T8B5+tyUKjsY7XV/Ad4ob8y52kQ1gmxtK09FXkR8im5sEmEaC3QWKQKqWc0XpZ7wwgw/cojVShQvEp25ZgVNxG0cPynIbIu0Y3yCO3c0WVq1QpmMx41ekMb61kBjQ4UYmSKcHODMt3MdP6VgFJOlAVCrP5KgIwAro2vqM+vSWEI8kNMBi/Zivve8hp4TQEAuhHjl9naQnrsoKsw9+CMatMVbDS56O+fmy8H0fnDtvW8SyZThjzhTK2Cee8KbbRF65LlXU9OpR6XOkfsTEseyVlaGm5C+engXl/YKnH8SNgzZNjE45ptYldOhKGlYrMqBv/Nivljsl3K9+yyLrTOE3qG5TxwEOPGoIOBjGGfvur91yP5pZnmefSMnryPEPlAQEzIBh21vqXvG+wYZh6U6YUPKDN3aZgBt4fjLWfcQbBZF95JixG/5CBOEExdrMfVJIbpoVeljcITw="
    #     on:
    #       repo: kuzzleio/kourou
    #       all_branches: true

