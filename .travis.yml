jobs:
  include:
    # - stage: Tests
    #   name: "Kourou Lint"
    #   language: node_js
    #   node_js: 12
    #   cache:
    #     directories:
    #       - ~/.npm
    #       - ~/.cache
    #       - node_modules # NPM packages

    #   install:
    #     - npm install --silent --unsafe-perm
    #     - npm install --silent --unsafe-perm --only=dev

    #   script:
    #     - npm run test:lint

    # - stage: Tests
    #   name: "Kourou Functional Stdout Tests"
    #   language: node_js
    #   node_js: 12
    #   cache:
    #     directories:
    #       - ~/.npm
    #       - ~/.cache
    #       - node_modules # NPM packages

    #   install:
    #     - npm install --silent --unsafe-perm
    #     - npm install --silent --unsafe-perm --only=dev

    #   script:
    #     - npm run test:functional:stdout

    # - stage: Tests
    #   name: "Kourou Functional Cucumber Tests"
    #   language: node_js
    #   node_js: 12
    #   cache:
    #     directories:
    #       - ~/.npm
    #       - ~/.cache
    #       - node_modules # NPM packages

    #   install:
    #     - npm install --silent --unsafe-perm
    #     - npm install --silent --unsafe-perm --only=dev

    #   script:
    #     - bash features/run-kuzzle-stack.sh
    #     - npm run test:functional:cucumber

    - stage: Deploy
      name: Deploy Kourou on NPM
      if: type = push AND branch = master
      sudo: false
      language: node_js
      node_js: 12
      install:
        - npm install
      deploy:
        provider: npm
        skip_cleanup: true
        email: support@kuzzle.io
        api_key:
          secure: W5ZnIHFdqai+xS07E1FwHglQU5zg3eJrYIrhtEQXuWT4iIh4IoiG/MGIAFt0hNwLPQigPGnaiy7W/i5/c5QsJAhIZTLE3CHFVH1OeePqYzF9G4PnpeydY/YiVAKjH5JpHqpnFI/q9Lz6ahvxtFfYxTaOoEXPyVRUaP8yWSmjVYnfDIqVbXxiZAhRO/y6DLmS+1dgjnAuiX1izI4D2A/HM1F6MdYTZhWlmYq9es3X5lPMq/AipEqVThmNes2d13Hv5OaVXXbMjDgPlbfwLhZiwCECd7UxvD1gPx2mSkaduDChb+QNdQP2LpYgjQsClPNROjwXUHgVgzarQdiYFMnwlExchQAgFnIMH9kuHIfww313BVCd4lc4lZEaB6Ijcn7KQnTsCIQBRm6PvouvUbQCTesZQ4uFNchLCwLuHs+FGTe1SMTfrC1Zm/0njs755NmWriiV3GIoVCQb90vqE/52WVvs12A5jbvQvnxrJ/auNKxyxpe4idp0hnDYe504IdCVT3s91/cw2tTRkAnFOMAQvIkZJ47Um/rH2o9LKgfOn0bxNudxVvKzhI5dHbRWgbXgpVVb2z3cxLRlPSSI9vjR69VW4OK2yz0Tjjmga12c86rTK/79aYvHC7xugr5Qs1c1iFl9UE2tEgwSPxGhLQ1HUCbpoN30CX5h3NhCwvbNujE=
        on:
          repo: kuzzleio/kourou
          all_branches: true

